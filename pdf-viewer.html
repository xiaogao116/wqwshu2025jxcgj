<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="keywords" content="知识再发现,数学创新能力,教学成果,上海大学,王卿文,PDF预览">
    <meta name="description" content="教学成果奖申报网站 - PDF预览页面">
    <title>PDF预览 - 教学成果奖申报网站</title>
    <style>
        /* 复用首页全局变量 */
        :root {
            --primary-blue: #1976D2; /* 主蓝色（明亮愉快） */
            --dark-blue: #0D47A1;    /* 深蓝色 */
            --deep-blue: #0A3D8C;    /* 更深蓝色（渐变） */
            --light-blue: #E3F2FD;   /* 浅蓝色 */
            --text-white: #FFFFFF;   /* 白色文字 */
            --text-dark: #333333;    /* 深色文字 */
            --text-gray: #666666;    /* 辅助文字色 */
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.2); /* 阴影 */
            --item-bg: #F0F7FF;      /* 列表项背景色 */
            --item-border: #D1E7FF;  /* 列表项边框色 */
        }
        
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: "Microsoft YaHei", "Noto Sans SC", Arial, sans-serif; 
        }
        
        body { 
            /* 复用首页背景样式 */
            width: 100vw;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--deep-blue) 0%, var(--dark-blue) 50%, var(--primary-blue) 100%);
            background-attachment: fixed;
            background-image: 
                radial-gradient(rgba(255, 255, 255, 0.05) 2px, transparent 2px),
                radial-gradient(rgba(255, 255, 255, 0.05) 2px, transparent 2px);
            background-size: 50px 50px;
            background-position: 0 0, 25px 25px;
            color: var(--text-dark);
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* 导航栏：修改为居中布局 */
        .nav-bar {
            /* 复用首页导航栏渐变背景 */
            background: linear-gradient(90deg, var(--dark-blue) 0%, var(--primary-blue) 100%);
            height: 70px;
            line-height: 70px;
            padding: 0 40px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
            display: flex;
            align-items: center;
            /* 关键修改：从justify-content: flex-end改为center */
            justify-content: center;
            position: relative;
            z-index: 99;
        }
        
        .btn-return {
            background-color: var(--text-white);
            color: var(--dark-blue);
            border: none;
            border-radius: 8px;
            padding: 10px 24px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            /* 增加:focus样式，提升可访问性 */
            outline: none;
        }
        
        .btn-return:hover {
            background-color: var(--light-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
            color: var(--deep-blue);
        }
        
        .btn-return:focus {
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.5);
        }

        /* PDF容器：扩大显示区域 */
        .pdf-container {
            flex: 1;
            width: 100vw;
            height: calc(100vh - 70px);
            overflow: auto; /* 容器自身滚动，适配大尺寸PDF */
            padding: 20px 40px; /* 减少内边距，扩大可用空间 */
            margin: 0;
            position: relative;
        }
        
        /* PDF预览区域：全屏适配+自动缩放 */
        #pdf-iframe {
            width: 100%;
            min-width: 100%;
            height: 100%;
            min-height: calc(100vh - 110px); /* 确保高度占满容器 */
            display: block;
            border: none;
            background-color: #FFFFFF;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.12);
            border-top: 4px solid var(--primary-blue);
            overflow: visible; /* 允许PDF内容自然显示 */
            margin: 0 auto;
        }

        /* 加载提示：匹配首页风格 */
        .loading-overlay {
            position: absolute;
            top: 70px;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 97;
        }
        
        .loading-text {
            font-size: 20px;
            color: var(--dark-blue);
            padding: 30px 40px;
            background: linear-gradient(180deg, #FFFFFF 0%, var(--light-blue) 100%);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.12);
            border-top: 4px solid var(--primary-blue);
            font-weight: bold;
            letter-spacing: 1px;
        }
        
        .loading-text button {
            margin-top: 15px;
            padding: 12px 24px;
            background-color: var(--primary-blue);
            color: var(--text-white);
            border: none;
            border-radius: 6px;
            font-size: 18px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 8px rgba(25, 118, 210, 0.2);
        }
        
        .loading-text button:hover {
            background-color: var(--dark-blue);
            transform: translateY(-2px);
        }

        /* 响应式适配（与首页完全一致） */
        @media (max-width: 992px) {
            .pdf-container {
                padding: 20px 20px;
            }
        }
        
        @media (max-width: 768px) {
            .nav-bar {
                padding: 0 20px;
                height: 60px;
                line-height: 60px;
            }
            
            .btn-return {
                padding: 8px 20px;
                font-size: 16px;
            }
            
            .pdf-container {
                padding: 15px 15px;
                height: calc(100vh - 60px);
            }
            
            #pdf-iframe {
                min-height: calc(100vh - 90px);
                border-radius: 8px;
            }
            
            .loading-overlay {
                top: 60px;
            }
            
            .loading-text {
                font-size: 18px;
                padding: 20px 30px;
            }
            
            .loading-text button {
                padding: 10px 20px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body oncontextmenu="return false;">
    <!-- 导航栏：匹配首页风格 -->
    <div class="nav-bar">
        <button class="btn-return" onclick="goBack()">返回上一页</button>
    </div>

    <!-- PDF预览容器 -->
    <div class="pdf-container">
        <!-- 加载提示 -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-text" id="loadingText">加载PDF中...</div>
        </div>

        <!-- PDF预览区域 -->
        <iframe id="pdf-iframe" onload="hideLoading()" oncontextmenu="return false;"></iframe>
    </div>

    <script>
        // 获取URL参数
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            const files = params.get('files') || '';
            const firstFile = files.split('|')[0] || '';
            const title = params.get('title') || 'PDF预览';
            const BASE_URL = 'https://xiaogao116.github.io/jiao20251219/';
            return {
                pdfUrl: firstFile ? `${BASE_URL}${encodeURIComponent(firstFile)}` : '',
                title: title
            };
        }

        // 返回上一页（优先返回来源页，无历史记录时才跳转到首页）
        function goBack() {
            // 优化历史记录判断，确保优先返回上一级页面
            if (window.history.length > 1) {
                window.history.back();
            } else {
                // 如果是直接打开的PDF页，尝试从referrer获取来源页
                const referrer = document.referrer;
                if (referrer && referrer.includes(window.location.hostname)) {
                    window.location.href = referrer;
                } else {
                    window.location.href = 'index.html';
                }
            }
        }

        // 隐藏加载提示
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        // 初始化加载PDF
        const { pdfUrl, title } = getUrlParams();
        const iframe = document.getElementById('pdf-iframe');
        
        if (pdfUrl) {
            // 优化PDF显示参数：自适应宽度+100%高度+隐藏工具栏
            const pdfUrlWithParam = pdfUrl + (pdfUrl.includes('#') ? '&' : '#') + 'toolbar=0&view=FitW&scrollbar=1&statusbar=0&messages=0';
            iframe.src = pdfUrlWithParam;
            document.title = `${title} - 教学成果奖申报网站`;
            document.getElementById('loadingText').textContent = `加载${title}中...`;
            
            // 超时重试
            setTimeout(() => {
                if (document.getElementById('loadingOverlay').style.display !== 'none') {
                    document.getElementById('loadingText').innerHTML = `
                        加载超时<br>
                        <button onclick="reloadPdf()">点击重试</button>
                    `;
                }
            }, 15000);
        } else {
            hideLoading();
            iframe.srcdoc = `<div style="text-align:center; padding:80px 20px; color:var(--text-gray); font-size:20px; line-height:2em;">
                <div style="color:var(--dark-blue); font-weight:bold; margin-bottom:20px;">未找到PDF文件</div>
                <button onclick="goBack()" style="padding:12px 24px; background-color:var(--primary-blue); color:white; border:none; border-radius:6px; font-size:18px; cursor:pointer;">返回</button>
            </div>`;
        }

        // 重试加载
        function reloadPdf() {
            document.getElementById('loadingText').textContent = `重新加载${title}中...`;
            const pdfUrlWithParam = pdfUrl + (pdfUrl.includes('#') ? '&' : '#') + `toolbar=0&view=FitW&scrollbar=1&statusbar=0&messages=0&t=${new Date().getTime()}`;
            iframe.src = pdfUrlWithParam;
        }

        // 禁用打印/下载/审查元素快捷键
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey && e.key === 's') || 
                (e.ctrlKey && e.key === 'p') || 
                (e.ctrlKey && e.shiftKey && e.key === 'i') ||
                (e.key === 'F12') ||
                (e.ctrlKey && e.key === 'u')) {
                e.preventDefault();
                return false;
            }
        });
    </script>
</body>
</html>